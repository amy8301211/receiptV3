<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>生活費/閒錢計算器（可編輯）</title>
  <style>
    body{font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; padding:20px; background:#f7f8fb; color:#111}
    h1{font-size:20px;margin:0 0 12px}
    .box{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(20,30,60,0.06);max-width:820px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    td,th{padding:8px 6px;text-align:left}
    input[type="number"]{width:120px;padding:6px;border-radius:6px;border:1px solid #ddd}
    .right{text-align:right}
    .muted{color:#666;font-size:13px}
    .controls{display:flex;gap:8px;margin-top:12px}
    button{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    button.ghost{background:#eef2ff;color:#1e293b}
    .result{margin-top:14px;padding:12px;border-radius:10px;background:#f1f5f9}
    .negative{color:#b91c1c;font-weight:700}
    .positive{color:#047857;font-weight:700}
    .small{font-size:13px}
    .add-row{margin-top:10px}
  </style>
</head>
<body>
  <div class="box">
    <h1>生活費計算器（HTML 單檔，可修改預設金額）</h1>
    <div class="muted">請直接編輯金額或新增項目，按「計算」得出加總與剩餘閒錢。結果可複製。</div>

    <table id="itemsTable">
      <thead>
        <tr>
          <th>項目</th>
          <th class="right">金額（元）</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- 預設項目 -->
      </tbody>
      <tfoot>
      </tfoot>
    </table>

    <div class="add-row">
      <button id="addCustom" class="ghost">＋ 新增自訂項目</button>
    </div>

    <div style="display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap">
      <div>
        <label class="small">月薪：</label>
        <input id="salary" type="number" value="33000" />
      </div>
      <div class="controls">
        <button id="calcBtn">計算</button>
        <button id="resetBtn" class="ghost">還原預設</button>
        <button id="exportBtn" class="ghost">輸出 HTML 檔</button>
      </div>
    </div>

    <div class="result" id="resultBox">
      <div>總支出：<span id="total">0</span> 元</div>
      <div>已刷卡金額（列入本月支出）：<span id="card">0</span> 元</div>
      <div>剩餘閒錢：<span id="left" class="positive">0</span> 元</div>
      <div style="margin-top:8px">
        <button id="copyBtn">複製結果</button>
      </div>
    </div>

  </div>

<script>
// 預設清單（來源：使用者提供）
const defaults = [
  ["保險(富邦)",19500],
  ["保險(遠銀)",13500],
  ["保險(合庫)",36600],
  ["房租",4500],
  ["電信費",499],
  ["加油費",300],
  ["年繳產險攤提",251],
  ["年繳牌照稅攤提",38],
  ["早餐",590],
  ["飲料",500],
  ["晚餐費",2500],
  ["生活用品",1200],
  ["目前已刷卡金額",500]
];

const tbody = document.querySelector('#itemsTable tbody');
const salaryInput = document.getElementById('salary');
const totalEl = document.getElementById('total');
const leftEl = document.getElementById('left');
const cardEl = document.getElementById('card');

function createRow(name, amount){
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="name" value="${escapeHtml(name)}" style="width:100%"/></td>
    <td class="right"><input class="amt" type="number" value="${Number(amount)||0}" /></td>
    <td class="right"><button class="del">刪除</button></td>
  `;
  tbody.appendChild(tr);
  tr.querySelector('.del').addEventListener('click',()=>{tr.remove();});
}

function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function loadDefaults(){ tbody.innerHTML=''; defaults.forEach(d=>createRow(d[0],d[1])); }

function calculate(){
  const salary = Number(salaryInput.value) || 0;
  const rows = Array.from(tbody.querySelectorAll('tr'));
  let total = 0;
  let card = 0;
  rows.forEach(r=>{
    const name = r.querySelector('.name').value || '';
    const amt = Number(r.querySelector('.amt').value) || 0;
    total += amt;
    if(name.includes('刷卡') || name.includes('刷卡金額') || name.includes('已刷')) card += amt;
  });
  const left = salary - total;
  totalEl.textContent = numberWithCommas(total);
  cardEl.textContent = numberWithCommas(card);
  leftEl.textContent = numberWithCommas(left);
  leftEl.className = left<0? 'negative':'positive';
}

function numberWithCommas(x){ return x.toLocaleString(); }

// 初始
loadDefaults(); calculate();

// 事件綁定
document.getElementById('calcBtn').addEventListener('click', calculate);
document.getElementById('addCustom').addEventListener('click', ()=>{ createRow('自訂項目',0); });
document.getElementById('resetBtn').addEventListener('click', ()=>{ if(confirm('還原為預設數值？')){ salaryInput.value=33000; loadDefaults(); calculate(); } });

// 實時重新計算（輸入改變時）
tbody.addEventListener('input', ()=>{ /* 不過度頻繁更新 */ });
salaryInput.addEventListener('change', calculate);

// 複製結果
document.getElementById('copyBtn').addEventListener('click', ()=>{
  const text = `月薪：${numberWithCommas(Number(salaryInput.value)||0)} 元\n總支出：${totalEl.textContent} 元\n已刷卡金額：${cardEl.textContent} 元\n剩餘閒錢：${leftEl.textContent} 元`;
  navigator.clipboard && navigator.clipboard.writeText(text).then(()=>{
    alert('結果已複製到剪貼簿');
  }, ()=>{ prompt('請手動複製結果：', text); });
});

// 匯出 HTML 檔（簡單方式：產生 data URL，下載 single-file）
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const content = document.documentElement.outerHTML;
  const blob = new Blob([content],{type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'life_calculator.html';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});

</script>
</body>
</html>
