<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>快速記帳表單</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .item { margin-bottom: 10px; }
    input, select { margin: 2px; padding: 4px; }
    button { margin-top: 10px; padding: 6px 12px; }
    textarea { width: 100%; height: 150px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>快速記帳表單</h2>

  <label>日期時間：
    <input type="datetime-local" id="datetime">
  </label>
  <br><br>

  <label>店家：
    <select id="shop">
      <option value="喫鍋 金山店">喫鍋 金山店</option>
      <option value="旭品關八">旭品關八</option>
      <option value="雙醬咖哩 金山店">雙醬咖哩 金山店</option>
      <option value="韓速拉麵-新竹金山店">韓速拉麵-新竹金山店</option>
      <option value="早安美芝城新竹金山概念店">早安美芝城新竹金山概念店</option>
      <option value="custom">自行輸入</option>
    </select>
    <input type="text" id="customShop" placeholder="輸入店家名稱" style="display:none;">
  </label>
  <br><br>

  <div id="items"></div>
  <button onclick="addItem()">新增品項</button>
  <br><br>

  <label>電子發票號碼：
    <input type="text" id="invoice" placeholder="可留空">
  </label>
  <br><br>

  <button onclick="generate()">產生文字</button>
  <button onclick="copyText()">一鍵複製</button>

  <textarea id="output" readonly></textarea>

  <script>
    // 預設今天時間
    document.getElementById("datetime").value = new Date().toISOString().slice(0,16);

    // 店家選單判斷
    document.getElementById("shop").addEventListener("change", function(){
      if(this.value === "custom"){
        document.getElementById("customShop").style.display = "inline-block";
      } else {
        document.getElementById("customShop").style.display = "none";
      }
    });

    function addItem(){
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        品名：<input type="text" class="name">
        單價：<input type="number" class="price" style="width:70px">
        數量：<input type="number" class="qty" value="1" style="width:50px">
        <button onclick="this.parentNode.remove()">刪除</button>
      `;
      document.getElementById("items").appendChild(div);
    }

    function generate(){
      const items = document.querySelectorAll(".item");
      let result = "";
      items.forEach(i=>{
        let name = i.querySelector(".name").value;
        let price = parseInt(i.querySelector(".price").value)||0;
        let qty = parseInt(i.querySelector(".qty").value)||1;
        let total = price*qty;
        result += `${name} ${price}元 x${qty} = ${total}元\n`;
      });

      let shop = document.getElementById("shop").value;
      if(shop === "custom"){
        shop = document.getElementById("customShop").value;
      }

      let datetime = document.getElementById("datetime").value.replace("T"," ");
      let invoice = document.getElementById("invoice").value;

      result += `${datetime} ${shop}\n`;
      result += invoice ? `#電子發票號碼: ${invoice}` : `#電子發票號碼: `;

      document.getElementById("output").value = result;
    }

    function copyText(){
      const text = document.getElementById("output");
      text.select();
      document.execCommand("copy");
      alert("已複製到剪貼簿！");
    }
  </script>
</body>
</html>